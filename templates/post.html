{% extends 'base.html' %}

{% block content %}
{% load static %}

<div class="d-flex justify-content-center mt-4">
    <div class="card shadow-sm" style="width: 40%;">
        <div class="card-body">
            <h5 class="fw-bold mb-1">{{ post.author }}</h5>
            <p class="text-muted small mb-3">{{ post.date_time }}</p>

            <a href="{% url 'post_update' post.pk %}">
                <button type="button" class="btn btn-outline-success">
                    <i class="bi bi-save"> Edit</i>
                </button>
            </a>

            <a href="{% url 'post_delete' post.pk %}">
                <button type="button" class="btn btn-outline-danger">
                    <i class="bi bi-delete"> Delete</i>
                </button>
            </a>

            <p class="text-dark small">{{ post.text }}</p>
        </div>
        <img src="{% static 'snp/images/' %}{{ post.img }}" class="card-img-bottom" alt="Cover Image">

        <!-- Like button section -->
        <div class="card-footer bg-white text-center">
            <button id="like-btn" class="btn btn-outline-primary">
                <i class="bi bi-hand-thumbs-up"></i> Like <span id="like-count">{{ post.likes.count }}</span>
            </button>
        </div>
    </div>
</div>

<script>
    document.getElementById("like-btn").addEventListener("click", function () {
        fetch("{% url 'like_post' post.pk %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({}),
        })
        .then(response => response.json())
        .then(data => {
            if (data.like_count !== undefined) {
                document.getElementById("like-count").innerText = data.like_count;
            } else {
                alert(data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
</script>

{% endblock content %}
